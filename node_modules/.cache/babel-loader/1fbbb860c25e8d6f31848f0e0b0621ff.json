{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React from'react';import usePortal from'react-useportal';import{useTranslation}from'react-i18next';// Form\nimport{Controller,useForm}from'react-hook-form';import{yupResolver}from'@hookform/resolvers/yup';import*as Yup from'yup';// Components\nimport MicRecorder from'components/MicRecorder';import WizardButtons from'components/WizardButtons';// Images\nimport UploadSVG from\"assets/icons/upload.svg\";// Styles\nimport{MainContainer,UploadContainer,UploadImage,UploadText,MicContainer}from'./style';var audioMaxSizeInMb=5;var schema=Yup.object({recordingFile:Yup.mixed().required('ERROR.FILE_REQUIRED').test('fileSize','ERROR.FILE_SIZE',function(value){if(value){var file=value;var size=file.size;return size<=Math.pow(1024,3)*audioMaxSizeInMb;}return!!value;}).test('fileDuration','ERROR.FILE_DURATION',/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value){var file,audio,duration;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!value){_context.next=10;break;}file=value;audio=new Audio(URL.createObjectURL(file));audio.load();_context.next=6;return new Promise(function(resolver){return audio.addEventListener('loadedmetadata',resolver);});case 6:_context.next=8;return new Promise(function(resolver){if(audio.duration!==Infinity){resolver(audio.duration);}audio.addEventListener('durationchange',function(){audio.remove();resolver(audio.duration);});audio.volume=0;audio.currentTime=24*60*60;// Unprobable time\naudio.play();});case 8:duration=_context.sent;return _context.abrupt(\"return\",duration>=2);case 10:return _context.abrupt(\"return\",!!value);case 11:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}())}).defined();var Record=function Record(_ref2){var onNext=_ref2.onNext,onManualUpload=_ref2.onManualUpload,defaultValues=_ref2.defaultValues,currentLogic=_ref2.currentLogic,action=_ref2.action;// Hooks\nvar _usePortal=usePortal({bindTo:document&&document.getElementById('wizard-buttons')}),Portal=_usePortal.Portal;var _useForm=useForm({mode:'onChange',defaultValues:defaultValues,resolver:yupResolver(schema)}),handleSubmit=_useForm.handleSubmit,control=_useForm.control,getValues=_useForm.getValues,formState=_useForm.formState;var _useTranslation=useTranslation(),t=_useTranslation.t;var isValid=formState.isValid;// Refs\nvar micKey=React.useRef(1);var onManualUploadWithFile=function onManualUploadWithFile(){action(_defineProperty({},currentLogic,{recordingFile:getValues('recordingFile')||null,uploadedFile:null}));onManualUpload===null||onManualUpload===void 0?void 0:onManualUpload();};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(MicContainer,{children:/*#__PURE__*/_jsx(Controller,{control:control,name:\"recordingFile\",render:function render(_ref3){var onChange=_ref3.onChange;return/*#__PURE__*/_jsx(MicRecorder,{// On delete, easy re-mount a new mic recorder\nonNewRecord:onChange,recordingFile:defaultValues===null||defaultValues===void 0?void 0:defaultValues.recordingFile},micKey.current);}})}),/*#__PURE__*/_jsxs(Portal,{children:[/*#__PURE__*/_jsx(WizardButtons,{invert:true,leftLabel:t('recordingsRecord:next'),leftDisabled:!isValid,leftHandler:handleSubmit(onNext)}),/*#__PURE__*/_jsxs(UploadContainer,{onClick:onManualUploadWithFile,children:[/*#__PURE__*/_jsx(UploadImage,{src:UploadSVG}),/*#__PURE__*/_jsx(UploadText,{children:t('recordingsRecord:upload')})]})]})]})});};export default/*#__PURE__*/React.memo(Record);","map":null,"metadata":{},"sourceType":"module"}