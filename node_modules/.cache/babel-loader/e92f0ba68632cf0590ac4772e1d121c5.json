{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable jsx-a11y/media-has-caption */ /* eslint-disable jsx-a11y/click-events-have-key-events */ /* eslint-disable jsx-a11y/no-static-element-interactions */import React,{useEffect}from'react';import{useHistory,useLocation}from'react-router-dom';import usePortal from'react-useportal';import{useTranslation,Trans}from'react-i18next';// Form\nimport{useStateMachine}from'little-state-machine';// Header Control\nimport useHeaderContext from'hooks/useHeaderContext';// Components\nimport WizardButtons from'components/WizardButtons';// Utils\nimport{updateAction}from'utils/wizard';import{scrollToTop}from'helper/scrollHelper';import{getDuration}from'helper/getDuration';// Images\nimport PlaySVG from\"assets/icons/play.svg\";import PauseSVG from\"assets/icons/pause.svg\";import CrossSVG from\"assets/icons/cross.svg\";// Styles\nimport fileHelper from'helper/fileHelper';import{MainContainer,Subtitle,PlayerContainer,PlayerContainerTop,PlayerContainerBottom,PlayerPlay,PlayerCross,PlayerFileName,PlayerTopMiddle,PlayerPlayContainer,PlayerPlayButton,PlayerCrossContainer,PlayerBottomTop,PlayerBottomTrack,PlayerBottomThumb,PlayerBottomBottom,PlayerTimeIndicator,ImportantNote}from'./style';var ListenAudio=function ListenAudio(_ref){var _state$storeKey;var storeKey=_ref.storeKey,previousStep=_ref.previousStep,nextStep=_ref.nextStep,metadata=_ref.metadata;// Hooks\nvar _usePortal=usePortal({bindTo:document&&document.getElementById('wizard-buttons')}),Portal=_usePortal.Portal;var _useHeaderContext=useHeaderContext(),setDoGoBack=_useHeaderContext.setDoGoBack,setSubtitle=_useHeaderContext.setSubtitle;var history=useHistory();var location=useLocation();var _useStateMachine=useStateMachine({updateAction:updateAction(storeKey)}),state=_useStateMachine.state,actions=_useStateMachine.actions;var _useTranslation=useTranslation(),t=_useTranslation.t;var myState=state===null||state===void 0?void 0:(_state$storeKey=state[storeKey])===null||_state$storeKey===void 0?void 0:_state$storeKey[metadata===null||metadata===void 0?void 0:metadata.currentLogic];var file=myState?myState.recordingFile||myState.uploadedFile:null;// Refs\nvar refAudio=React.useRef(null);var refTimer=React.useRef();var refProgress=React.useRef(0);// States\nvar _React$useState=React.useState(true),_React$useState2=_slicedToArray(_React$useState,2),activeStep=_React$useState2[0],setActiveStep=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),playing=_React$useState4[0],setPlaying=_React$useState4[1];var _React$useState5=React.useState(0),_React$useState6=_slicedToArray(_React$useState5,2),duration=_React$useState6[0],setDuration=_React$useState6[1];var _React$useState7=React.useState(0),_React$useState8=_slicedToArray(_React$useState7,2),progressSeconds=_React$useState8[0],setProgressSeconds=_React$useState8[1];// Effects\nReact.useEffect(function(){var stepTimer=function stepTimer(ms){setProgressSeconds(ms/1000);refProgress.current=ms;refTimer.current=setTimeout(function(){stepTimer(ms+200);},200);};var fnPlaying=function fnPlaying(){stepTimer(refProgress.current);setTimeout(function(){setPlaying(true);},0);};var fnPause=function fnPause(e){if(e.target.currentTime>=e.target.duration){setProgressSeconds(0);refProgress.current=0;}setPlaying(false);clearTimeout(refTimer.current);};var fnLoad=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var recordDuration;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getDuration(e.target);case 2:recordDuration=_context.sent;setDuration(recordDuration);case 4:case\"end\":return _context.stop();}}},_callee);}));return function fnLoad(_x){return _ref2.apply(this,arguments);};}();if(refAudio.current){refAudio.current.addEventListener('playing',fnPlaying);refAudio.current.addEventListener('pause',fnPause);refAudio.current.addEventListener('loadedmetadata',fnLoad);}return function(){if(refAudio.current){refAudio.current.removeEventListener('playing',fnPlaying);// eslint-disable-next-line react-hooks/exhaustive-deps\nrefAudio.current.removeEventListener('pause',fnPause);// eslint-disable-next-line react-hooks/exhaustive-deps\nrefAudio.current.removeEventListener('loadedmetadata',fnLoad);}};},[]);// Memos\nvar _React$useMemo=React.useMemo(function(){var out={fileUrl:'',fileName:'',fileSize:''};if(file&&file.size!==undefined){try{var url=URL.createObjectURL(file);out.fileUrl=url;out.fileName=file.name;out.fileSize=fileHelper.sizeAsHuman(file.size,true);}catch(e){console.log('Error',e);}}return out;},[file]),fileUrl=_React$useMemo.fileUrl,fileName=_React$useMemo.fileName;// Handlers\nvar handleNext=React.useCallback(function(){if(nextStep){// action(values);\nsetActiveStep(false);history.push(nextStep);}},[history,nextStep]);var handleDoBack=React.useCallback(function(){if(playing){if(refAudio.current){refAudio.current.pause();}}setActiveStep(false);if(location.state&&location.state.from){var newRoute='/submit-steps/step-record/cough';history.push(newRoute);}else if(previousStep){history.push(previousStep);}else{history.goBack();}},[location.state,previousStep,history,playing]);var handleRemoveFile=React.useCallback(function(){if(playing){if(refAudio.current){refAudio.current.pause();}}if(state===null||state===void 0?void 0:state[storeKey][metadata===null||metadata===void 0?void 0:metadata.currentLogic]){actions.updateAction(_defineProperty({},metadata===null||metadata===void 0?void 0:metadata.currentLogic,{recordingFile:null,uploadFile:null}));handleDoBack();}},[playing,state,storeKey,metadata,actions,handleDoBack]);var handlePlay=React.useCallback(function(){if(!playing){setProgressSeconds(0);if(refAudio.current){refAudio.current.play();}}},[playing]);var handlePause=React.useCallback(function(){if(playing){if(refAudio.current){refAudio.current.pause();}}},[playing]);// Effects\nuseEffect(function(){scrollToTop();setSubtitle(t('recordingsListen:title'));setDoGoBack(function(){return handleDoBack;});},[handleDoBack,setDoGoBack,setSubtitle,t]);// Memos\nvar _React$useMemo2=React.useMemo(function(){var out={currentTime:'0:00',remainingTime:'0:00',trackProgress:0};if(duration){var minutes=Math.floor(Math.floor(progressSeconds)/60);var seconds=Math.floor(progressSeconds)-minutes*60;out.currentTime=\"\".concat(minutes,\":\").concat(seconds<10?\"0\".concat(seconds):seconds);var timeRemaining=duration>progressSeconds?Math.ceil(duration-progressSeconds):0;var minutesRemaining=Math.floor(timeRemaining/60);var secondsRemaining=timeRemaining-minutesRemaining*60;out.remainingTime=\"-\".concat(minutesRemaining,\":\").concat(secondsRemaining<10?\"0\".concat(secondsRemaining):secondsRemaining);out.trackProgress=Math.ceil(progressSeconds/duration*100);}return out;},[duration,progressSeconds]),currentTime=_React$useMemo2.currentTime,remainingTime=_React$useMemo2.remainingTime,trackProgress=_React$useMemo2.trackProgress;return/*#__PURE__*/_jsxs(_Fragment,{children:[fileUrl&&/*#__PURE__*/_jsx(\"audio\",{ref:refAudio,children:/*#__PURE__*/_jsx(\"source\",{src:fileUrl})}),/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(Subtitle,{children:t('recordingsListen:subtitle')}),/*#__PURE__*/_jsxs(PlayerContainer,{children:[/*#__PURE__*/_jsxs(PlayerContainerTop,{children:[/*#__PURE__*/_jsx(PlayerTopMiddle,{children:/*#__PURE__*/_jsx(PlayerFileName,{children:fileName})}),/*#__PURE__*/_jsx(PlayerCrossContainer,{onClick:handleRemoveFile,children:/*#__PURE__*/_jsx(PlayerCross,{src:CrossSVG})})]}),/*#__PURE__*/_jsxs(PlayerContainerBottom,{children:[/*#__PURE__*/_jsxs(PlayerBottomTop,{children:[/*#__PURE__*/_jsx(PlayerBottomTrack,{playing:playing,progress:trackProgress}),/*#__PURE__*/_jsx(PlayerBottomThumb,{playing:playing,progress:trackProgress})]}),/*#__PURE__*/_jsxs(PlayerBottomBottom,{children:[/*#__PURE__*/_jsx(PlayerTimeIndicator,{children:currentTime}),/*#__PURE__*/_jsx(PlayerTimeIndicator,{children:remainingTime})]})]})]}),/*#__PURE__*/_jsx(PlayerPlayContainer,{onClick:playing?handlePause:handlePlay,children:/*#__PURE__*/_jsx(PlayerPlayButton,{children:/*#__PURE__*/_jsx(PlayerPlay,{src:playing?PauseSVG:PlaySVG})})})]}),/*#__PURE__*/_jsx(ImportantNote,{children:/*#__PURE__*/_jsxs(Trans,{i18nKey:\"main:note\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Please note:\"}),\" This form is for data collection only. It will not predict your COVID-19 status or diagnose any disease, disorder, or other health condition. Virufy is conducting research and will use the information you provide for that research only. Virufy will not take place of a doctor and would like to remind you it is your responsibility to seek medical advice from your doctor.\"]})}),activeStep&&/*#__PURE__*/_jsx(Portal,{children:/*#__PURE__*/_jsx(WizardButtons,{invert:true,leftLabel:t('recordingsListen:next'),leftHandler:handleNext,rightLabel:t('recordingsListen:retake'),rightHandler:handleRemoveFile})})]});};export default/*#__PURE__*/React.memo(ListenAudio);","map":null,"metadata":{},"sourceType":"module"}