{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _slicedToArray from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useEffect,useRef}from'react';import{useHistory}from'react-router-dom';import usePortal from'react-useportal';import{useTranslation}from'react-i18next';// Form\nimport{Controller,useForm}from'react-hook-form';import{useStateMachine}from'little-state-machine';import{yupResolver}from'@hookform/resolvers/yup';import*as Yup from'yup';// Components\nimport WizardButtons from'components/WizardButtons';// Header Control\nimport useHeaderContext from'hooks/useHeaderContext';// Utils\nimport{updateAction}from'utils/wizard';import{scrollToTop}from'helper/scrollHelper';// Styles\nimport{MainContainer,Title,TextErrorContainer,UploadContainer,UploadInput,UploadButton,CloudsSVG,ArrowUp}from'./style';var audioMaxSizeInMb=5;var mimeTypes='audio/wav,audio/wave,audio/wav,audio/x-wav,audio/x-pn-wav,audio/mp3,audio/ogg';var schema=Yup.object({uploadedFile:Yup.mixed().required('ERROR.FILE_REQUIRED').test('fileSize','ERROR.FILE_SIZE',function(value){if(value){var file=value;var size=file.size;return size<=Math.pow(1024,3)*audioMaxSizeInMb;}return!!value;}).test('fileDuration','ERROR.FILE_DURATION',/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value){var file,audio;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!value){_context.next=7;break;}file=value;audio=new Audio(URL.createObjectURL(file));audio.load();_context.next=6;return new Promise(function(resolver){return audio.addEventListener('loadedmetadata',resolver);});case 6:return _context.abrupt(\"return\",audio.duration>=3);case 7:return _context.abrupt(\"return\",!!value);case 8:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}())}).defined();var RecordManualUpload=function RecordManualUpload(_ref2){var _state$storeKey;var storeKey=_ref2.storeKey,previousStep=_ref2.previousStep,nextStep=_ref2.nextStep,metadata=_ref2.metadata;// Hooks\nvar _usePortal=usePortal({bindTo:document&&document.getElementById('wizard-buttons')}),Portal=_usePortal.Portal;var _useHeaderContext=useHeaderContext(),setDoGoBack=_useHeaderContext.setDoGoBack,setTitle=_useHeaderContext.setTitle,setSubtitle=_useHeaderContext.setSubtitle,setType=_useHeaderContext.setType;var history=useHistory();var _useStateMachine=useStateMachine({updateAction:updateAction(storeKey)}),state=_useStateMachine.state,actions=_useStateMachine.actions;var _useForm=useForm({mode:'onChange',defaultValues:state===null||state===void 0?void 0:(_state$storeKey=state[storeKey])===null||_state$storeKey===void 0?void 0:_state$storeKey[metadata===null||metadata===void 0?void 0:metadata.currentLogic],resolver:yupResolver(schema)}),control=_useForm.control;var _useTranslation=useTranslation(),t=_useTranslation.t;// States\nvar _React$useState=React.useState(true),_React$useState2=_slicedToArray(_React$useState,2),activeStep=_React$useState2[0],setActiveStep=_React$useState2[1];var _React$useState3=React.useState(''),_React$useState4=_slicedToArray(_React$useState3,2),errorMsg=_React$useState4[0],setErrorMsg=_React$useState4[1];var inputUpload=useRef(null);// Handlers\nvar handleNext=React.useCallback(function(values){if(nextStep){actions.updateAction(_defineProperty({},metadata===null||metadata===void 0?void 0:metadata.currentLogic,{recordingFile:null,uploadedFile:values}));setActiveStep(false);history.push(nextStep,{from:'step-manual-upload'});}},[nextStep,actions,metadata,history]);var handleDoBack=React.useCallback(function(){setActiveStep(false);if(previousStep){history.push(previousStep);}else{history.goBack();}},[history,previousStep]);var handleUpload=React.useCallback(function(e){schema.validate({uploadedFile:e}).then(function(){handleNext(e);}).catch(function(err){if(err.errors[0]==='ERROR.FILE_SIZE'){setErrorMsg(t('recordingsRecordManual:fileSizeTooBig'));}if(err.errors[0]==='ERROR.FILE_REQUIRED'){setErrorMsg(t('recordingsRecordManual:fileRequired'));}else{setErrorMsg(t('recordingsRecordManual:fileDurationTooShort'));}});},[handleNext,t]);// Effects\nuseEffect(function(){scrollToTop();setTitle(t('recordingsRecordManual:header'));setSubtitle('');setType('shapeUp');setDoGoBack(function(){return handleDoBack;});},[handleDoBack,setDoGoBack,setType,setSubtitle,setTitle,t]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(Title,{children:t('recordingsRecordManual:micError')}),/*#__PURE__*/_jsx(CloudsSVG,{}),/*#__PURE__*/_jsx(Controller,{control:control,name:\"uploadedFile\",render:function render(_ref3){var name=_ref3.name;return/*#__PURE__*/_jsxs(UploadContainer,{children:[/*#__PURE__*/_jsx(UploadButton,{htmlFor:\"uploaded-file\"}),/*#__PURE__*/_jsx(ArrowUp,{}),/*#__PURE__*/_jsx(UploadInput,{ref:inputUpload,id:\"uploaded-file\",type:\"file\",name:name,accept:mimeTypes,onChange:function onChange(e){var _e$currentTarget$file;return handleUpload((_e$currentTarget$file=e.currentTarget.files)===null||_e$currentTarget$file===void 0?void 0:_e$currentTarget$file[0]);}})]});}})]}),/*#__PURE__*/_jsx(TextErrorContainer,{children:errorMsg}),activeStep&&/*#__PURE__*/_jsx(Portal,{children:/*#__PURE__*/_jsx(WizardButtons,{invert:true,leftLabel:t('recordingsRecordManual:uploadFile'),leftHandler:function leftHandler(){var _inputUpload$current;return(_inputUpload$current=inputUpload.current)===null||_inputUpload$current===void 0?void 0:_inputUpload$current.click();}})})]});};export default/*#__PURE__*/React.memo(RecordManualUpload);","map":null,"metadata":{},"sourceType":"module"}