{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";/* eslint-disable jsx-a11y/media-has-caption */ /* eslint-disable jsx-a11y/click-events-have-key-events */ /* eslint-disable jsx-a11y/no-static-element-interactions */import React,{useEffect}from'react';import{useHistory,useLocation}from'react-router-dom';import usePortal from'react-useportal';import{useTranslation,Trans}from'react-i18next';// Form\nimport{useStateMachine}from'little-state-machine';// Header Control\nimport useHeaderContext from'hooks/useHeaderContext';// Components\nimport WizardButtons from'components/WizardButtons';// Utils\nimport{updateAction}from'utils/wizard';import{scrollToTop}from'helper/scrollHelper';import{getDuration}from'helper/getDuration';// Images\nimport PlaySVG from\"assets/icons/play.svg\";import PauseSVG from\"assets/icons/pause.svg\";import CrossSVG from\"assets/icons/cross.svg\";// Styles\nimport fileHelper from'helper/fileHelper';import{MainContainer,Subtitle,PlayerContainer,PlayerContainerTop,PlayerContainerBottom,PlayerPlay,PlayerCross,PlayerFileName,PlayerTopMiddle,PlayerPlayContainer,PlayerPlayButton,PlayerCrossContainer,PlayerBottomTop,PlayerBottomTrack,PlayerBottomThumb,PlayerBottomBottom,PlayerTimeIndicator,ImportantNote}from'./style';var ListenAudio=function ListenAudio(_ref){var _state$storeKey;var storeKey=_ref.storeKey,previousStep=_ref.previousStep,nextStep=_ref.nextStep,metadata=_ref.metadata;// Hooks\nvar _usePortal=usePortal({bindTo:document&&document.getElementById('wizard-buttons')}),Portal=_usePortal.Portal;var _useHeaderContext=useHeaderContext(),setDoGoBack=_useHeaderContext.setDoGoBack,setSubtitle=_useHeaderContext.setSubtitle;var history=useHistory();var location=useLocation();var _useStateMachine=useStateMachine({updateAction:updateAction(storeKey)}),state=_useStateMachine.state,actions=_useStateMachine.actions;var _useTranslation=useTranslation(),t=_useTranslation.t;var myState=state===null||state===void 0?void 0:(_state$storeKey=state[storeKey])===null||_state$storeKey===void 0?void 0:_state$storeKey[metadata===null||metadata===void 0?void 0:metadata.currentLogic];var file=myState?myState.recordingFile||myState.uploadedFile:null;// Refs\nvar refAudio=React.useRef(null);var refTimer=React.useRef();var refProgress=React.useRef(0);// States\nvar _React$useState=React.useState(true),_React$useState2=_slicedToArray(_React$useState,2),activeStep=_React$useState2[0],setActiveStep=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),playing=_React$useState4[0],setPlaying=_React$useState4[1];var _React$useState5=React.useState(0),_React$useState6=_slicedToArray(_React$useState5,2),duration=_React$useState6[0],setDuration=_React$useState6[1];var _React$useState7=React.useState(0),_React$useState8=_slicedToArray(_React$useState7,2),progressSeconds=_React$useState8[0],setProgressSeconds=_React$useState8[1];// Effects\nReact.useEffect(function(){var stepTimer=function stepTimer(ms){setProgressSeconds(ms/1000);refProgress.current=ms;refTimer.current=setTimeout(function(){stepTimer(ms+200);},200);};var fnPlaying=function fnPlaying(){stepTimer(refProgress.current);setTimeout(function(){setPlaying(true);},0);};var fnPause=function fnPause(e){if(e.target.currentTime>=e.target.duration){setProgressSeconds(0);refProgress.current=0;}setPlaying(false);clearTimeout(refTimer.current);};var fnLoad=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var recordDuration;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getDuration(e.target);case 2:recordDuration=_context.sent;setDuration(recordDuration);case 4:case\"end\":return _context.stop();}}},_callee);}));return function fnLoad(_x){return _ref2.apply(this,arguments);};}();if(refAudio.current){refAudio.current.addEventListener('playing',fnPlaying);refAudio.current.addEventListener('pause',fnPause);refAudio.current.addEventListener('loadedmetadata',fnLoad);}return function(){if(refAudio.current){refAudio.current.removeEventListener('playing',fnPlaying);// eslint-disable-next-line react-hooks/exhaustive-deps\nrefAudio.current.removeEventListener('pause',fnPause);// eslint-disable-next-line react-hooks/exhaustive-deps\nrefAudio.current.removeEventListener('loadedmetadata',fnLoad);}};},[]);// Memos\nvar _React$useMemo=React.useMemo(function(){var out={fileUrl:'',fileName:'',fileSize:''};if(file&&file.size!==undefined){try{var url=URL.createObjectURL(file);out.fileUrl=url;out.fileName=file.name;out.fileSize=fileHelper.sizeAsHuman(file.size,true);}catch(e){console.log('Error',e);}}return out;},[file]),fileUrl=_React$useMemo.fileUrl,fileName=_React$useMemo.fileName;// Handlers\nvar handleNext=React.useCallback(function(){if(nextStep){// action(values);\nsetActiveStep(false);history.push(nextStep);}},[history,nextStep]);var handleDoBack=React.useCallback(function(){if(playing){if(refAudio.current){refAudio.current.pause();}}setActiveStep(false);if(location.state&&location.state.from){var newRoute='/submit-steps/step-record/cough';history.push(newRoute);}else if(previousStep){history.push(previousStep);}else{history.goBack();}},[location.state,previousStep,history,playing]);var handleRemoveFile=React.useCallback(function(){if(playing){if(refAudio.current){refAudio.current.pause();}}if(state===null||state===void 0?void 0:state[storeKey][metadata===null||metadata===void 0?void 0:metadata.currentLogic]){actions.updateAction(_defineProperty({},metadata===null||metadata===void 0?void 0:metadata.currentLogic,{recordingFile:null,uploadFile:null}));handleDoBack();}},[playing,state,storeKey,metadata,actions,handleDoBack]);var handlePlay=React.useCallback(function(){if(!playing){setProgressSeconds(0);if(refAudio.current){refAudio.current.play();}}},[playing]);var handlePause=React.useCallback(function(){if(playing){if(refAudio.current){refAudio.current.pause();}}},[playing]);// Effects\nuseEffect(function(){scrollToTop();setSubtitle(t('recordingsListen:title'));setDoGoBack(function(){return handleDoBack;});},[handleDoBack,setDoGoBack,setSubtitle,t]);// Memos\nvar _React$useMemo2=React.useMemo(function(){var out={currentTime:'0:00',remainingTime:'0:00',trackProgress:0};if(duration){var minutes=Math.floor(Math.floor(progressSeconds)/60);var seconds=Math.floor(progressSeconds)-minutes*60;out.currentTime=\"\".concat(minutes,\":\").concat(seconds<10?\"0\".concat(seconds):seconds);var timeRemaining=duration>progressSeconds?Math.ceil(duration-progressSeconds):0;var minutesRemaining=Math.floor(timeRemaining/60);var secondsRemaining=timeRemaining-minutesRemaining*60;out.remainingTime=\"-\".concat(minutesRemaining,\":\").concat(secondsRemaining<10?\"0\".concat(secondsRemaining):secondsRemaining);out.trackProgress=Math.ceil(progressSeconds/duration*100);}return out;},[duration,progressSeconds]),currentTime=_React$useMemo2.currentTime,remainingTime=_React$useMemo2.remainingTime,trackProgress=_React$useMemo2.trackProgress;return/*#__PURE__*/_jsxs(_Fragment,{children:[fileUrl&&/*#__PURE__*/_jsx(\"audio\",{ref:refAudio,children:/*#__PURE__*/_jsx(\"source\",{src:fileUrl})}),/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(Subtitle,{children:t('recordingsListen:subtitle')}),/*#__PURE__*/_jsxs(PlayerContainer,{children:[/*#__PURE__*/_jsxs(PlayerContainerTop,{children:[/*#__PURE__*/_jsx(PlayerTopMiddle,{children:/*#__PURE__*/_jsx(PlayerFileName,{children:fileName})}),/*#__PURE__*/_jsx(PlayerCrossContainer,{onClick:handleRemoveFile,children:/*#__PURE__*/_jsx(PlayerCross,{src:CrossSVG})})]}),/*#__PURE__*/_jsxs(PlayerContainerBottom,{children:[/*#__PURE__*/_jsxs(PlayerBottomTop,{children:[/*#__PURE__*/_jsx(PlayerBottomTrack,{playing:playing,progress:trackProgress}),/*#__PURE__*/_jsx(PlayerBottomThumb,{playing:playing,progress:trackProgress})]}),/*#__PURE__*/_jsxs(PlayerBottomBottom,{children:[/*#__PURE__*/_jsx(PlayerTimeIndicator,{children:currentTime}),/*#__PURE__*/_jsx(PlayerTimeIndicator,{children:remainingTime})]})]})]}),/*#__PURE__*/_jsx(PlayerPlayContainer,{onClick:playing?handlePause:handlePlay,children:/*#__PURE__*/_jsx(PlayerPlayButton,{children:/*#__PURE__*/_jsx(PlayerPlay,{src:playing?PauseSVG:PlaySVG})})})]}),/*#__PURE__*/_jsx(ImportantNote,{children:/*#__PURE__*/_jsxs(Trans,{i18nKey:\"main:note\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Please note:\"}),\" This form is for data collection only. It will not predict your COVID-19 status or diagnose any disease, disorder, or other health condition. Virufy is conducting research and will use the information you provide for that research only. Virufy will not take place of a doctor and would like to remind you it is your responsibility to seek medical advice from your doctor.\"]})}),activeStep&&/*#__PURE__*/_jsx(Portal,{children:/*#__PURE__*/_jsx(WizardButtons,{invert:true,leftLabel:t('recordingsListen:next'),leftHandler:handleNext,rightLabel:t('recordingsListen:retake'),rightHandler:handleRemoveFile})})]});};export default/*#__PURE__*/React.memo(ListenAudio);","map":{"version":3,"sources":["/home/amil/virufy-demo.github.io/src/containers/SubmitSteps/RecordingsSteps/ListenAudio/ListenAudio.tsx"],"names":["React","useEffect","useHistory","useLocation","usePortal","useTranslation","Trans","useStateMachine","useHeaderContext","WizardButtons","updateAction","scrollToTop","getDuration","fileHelper","MainContainer","Subtitle","PlayerContainer","PlayerContainerTop","PlayerContainerBottom","PlayerPlay","PlayerCross","PlayerFileName","PlayerTopMiddle","PlayerPlayContainer","PlayerPlayButton","PlayerCrossContainer","PlayerBottomTop","PlayerBottomTrack","PlayerBottomThumb","PlayerBottomBottom","PlayerTimeIndicator","ImportantNote","ListenAudio","storeKey","previousStep","nextStep","metadata","bindTo","document","getElementById","Portal","setDoGoBack","setSubtitle","history","location","state","actions","t","myState","currentLogic","file","recordingFile","uploadedFile","refAudio","useRef","refTimer","refProgress","useState","activeStep","setActiveStep","playing","setPlaying","duration","setDuration","progressSeconds","setProgressSeconds","stepTimer","ms","current","setTimeout","fnPlaying","fnPause","e","target","currentTime","clearTimeout","fnLoad","recordDuration","addEventListener","removeEventListener","useMemo","out","fileUrl","fileName","fileSize","size","undefined","url","URL","createObjectURL","name","sizeAsHuman","console","log","handleNext","useCallback","push","handleDoBack","pause","from","newRoute","goBack","handleRemoveFile","uploadFile","handlePlay","play","handlePause","remainingTime","trackProgress","minutes","Math","floor","seconds","timeRemaining","ceil","minutesRemaining","secondsRemaining","CrossSVG","PauseSVG","PlaySVG","memo"],"mappings":"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","sourcesContent":["/* eslint-disable jsx-a11y/media-has-caption */\n/* eslint-disable jsx-a11y/click-events-have-key-events */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React, { useEffect } from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport usePortal from 'react-useportal';\nimport { useTranslation, Trans } from 'react-i18next';\n\n// Form\nimport { useStateMachine } from 'little-state-machine';\n\n// Header Control\nimport useHeaderContext from 'hooks/useHeaderContext';\n\n// Components\nimport WizardButtons from 'components/WizardButtons';\n\n// Utils\nimport { updateAction } from 'utils/wizard';\nimport { scrollToTop } from 'helper/scrollHelper';\nimport { getDuration } from 'helper/getDuration';\n\n// Images\nimport PlaySVG from 'assets/icons/play.svg';\nimport PauseSVG from 'assets/icons/pause.svg';\nimport CrossSVG from 'assets/icons/cross.svg';\n\n// Styles\nimport fileHelper from 'helper/fileHelper';\nimport {\n  MainContainer,\n  Subtitle,\n  PlayerContainer,\n  PlayerContainerTop,\n  PlayerContainerBottom,\n  PlayerPlay,\n  PlayerCross,\n  PlayerFileName,\n  PlayerTopMiddle,\n  PlayerPlayContainer,\n  PlayerPlayButton,\n  PlayerCrossContainer,\n  PlayerBottomTop,\n  PlayerBottomTrack,\n  PlayerBottomThumb,\n  PlayerBottomBottom,\n  PlayerTimeIndicator,\n  ImportantNote,\n} from './style';\n\nconst ListenAudio = ({\n  storeKey,\n  previousStep,\n  nextStep,\n  metadata,\n}: Wizard.StepProps) => {\n  // Hooks\n  const { Portal } = usePortal({\n    bindTo: document && document.getElementById('wizard-buttons') as HTMLDivElement,\n  });\n  const { setDoGoBack, setSubtitle } = useHeaderContext();\n  const history = useHistory();\n  const location = useLocation<{ from: string }>();\n  const { state, actions } = useStateMachine({ updateAction: updateAction(storeKey) });\n  const { t } = useTranslation();\n\n  const myState = state?.[storeKey]?.[metadata?.currentLogic];\n  const file: File | null = myState ? myState.recordingFile || myState.uploadedFile : null;\n\n  // Refs\n  const refAudio = React.useRef<HTMLMediaElement>(null);\n  const refTimer = React.useRef<any>();\n  const refProgress = React.useRef<number>(0);\n\n  // States\n  const [activeStep, setActiveStep] = React.useState(true);\n  const [playing, setPlaying] = React.useState(false);\n  const [duration, setDuration] = React.useState<number>(0);\n  const [progressSeconds, setProgressSeconds] = React.useState<number>(0);\n\n  // Effects\n  React.useEffect(() => {\n    const stepTimer = (ms: number) => {\n      setProgressSeconds(ms / 1000);\n      refProgress.current = ms;\n      refTimer.current = setTimeout(() => {\n        stepTimer(ms + 200);\n      }, 200);\n    };\n\n    const fnPlaying = () => {\n      stepTimer(refProgress.current);\n      setTimeout(() => {\n        setPlaying(true);\n      }, 0);\n    };\n\n    const fnPause = (e: any) => {\n      if (e.target.currentTime >= e.target.duration) {\n        setProgressSeconds(0);\n        refProgress.current = 0;\n      }\n      setPlaying(false);\n      clearTimeout(refTimer.current);\n    };\n\n    const fnLoad = async (e: any) => {\n      const recordDuration = await getDuration(e.target);\n      setDuration(recordDuration);\n    };\n\n    if (refAudio.current) {\n      refAudio.current.addEventListener('playing', fnPlaying);\n      refAudio.current.addEventListener('pause', fnPause);\n      refAudio.current.addEventListener('loadedmetadata', fnLoad);\n    }\n\n    return () => {\n      if (refAudio.current) {\n        refAudio.current.removeEventListener('playing', fnPlaying);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        refAudio.current.removeEventListener('pause', fnPause);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        refAudio.current.removeEventListener('loadedmetadata', fnLoad);\n      }\n    };\n  }, []);\n\n  // Memos\n  const {\n    fileUrl,\n    fileName,\n  } = React.useMemo(() => {\n    const out = {\n      fileUrl: '',\n      fileName: '',\n      fileSize: '',\n    };\n    if (file && file.size !== undefined) {\n      try {\n        const url = URL.createObjectURL(file);\n        out.fileUrl = url;\n        out.fileName = file.name;\n        out.fileSize = fileHelper.sizeAsHuman(file.size, true);\n      } catch (e) {\n        console.log('Error', e);\n      }\n    }\n    return out;\n  }, [file]);\n\n  // Handlers\n  const handleNext = React.useCallback(() => {\n    if (nextStep) {\n      // action(values);\n      setActiveStep(false);\n      history.push(nextStep);\n    }\n  }, [history, nextStep]);\n\n  const handleDoBack = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n    setActiveStep(false);\n    if (location.state && location.state.from) {\n      const newRoute = '/submit-steps/step-record/cough';\n      history.push(newRoute);\n    } else if (previousStep) {\n      history.push(previousStep);\n    } else {\n      history.goBack();\n    }\n  }, [location.state, previousStep, history, playing]);\n\n  const handleRemoveFile = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n\n    if (state?.[storeKey][metadata?.currentLogic]) {\n      actions.updateAction({\n        [metadata?.currentLogic]: {\n          recordingFile: null,\n          uploadFile: null,\n        },\n      });\n      handleDoBack();\n    }\n  }, [\n    playing,\n    state,\n    storeKey,\n    metadata,\n    actions,\n    handleDoBack,\n  ]);\n\n  const handlePlay = React.useCallback(() => {\n    if (!playing) {\n      setProgressSeconds(0);\n      if (refAudio.current) {\n        refAudio.current.play();\n      }\n    }\n  }, [playing]);\n\n  const handlePause = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n  }, [playing]);\n\n  // Effects\n  useEffect(() => {\n    scrollToTop();\n    setSubtitle(t('recordingsListen:title'));\n    setDoGoBack(() => handleDoBack);\n  }, [handleDoBack, setDoGoBack, setSubtitle, t]);\n\n  // Memos\n  const {\n    currentTime,\n    remainingTime,\n    trackProgress,\n  } = React.useMemo(() => {\n    const out = {\n      currentTime: '0:00',\n      remainingTime: '0:00',\n      trackProgress: 0,\n    };\n    if (duration) {\n      const minutes = Math.floor(Math.floor(progressSeconds) / 60);\n      const seconds = Math.floor(progressSeconds) - (minutes * 60);\n      out.currentTime = `${minutes}:${seconds < 10 ? `0${seconds}` : seconds}`;\n\n      const timeRemaining = duration > progressSeconds ? Math.ceil(duration - progressSeconds) : 0;\n      const minutesRemaining = Math.floor(timeRemaining / 60);\n      const secondsRemaining = timeRemaining - (minutesRemaining * 60);\n      out.remainingTime = `-${minutesRemaining}:${secondsRemaining < 10 ? `0${secondsRemaining}` : secondsRemaining}`;\n\n      out.trackProgress = Math.ceil((progressSeconds / duration) * 100);\n    }\n    return out;\n  }, [duration, progressSeconds]);\n\n  return (\n    <>\n      {\n        fileUrl && (\n          <audio\n            ref={refAudio}\n          >\n            <source\n              src={fileUrl}\n            />\n          </audio>\n        )\n      }\n      <MainContainer>\n        <Subtitle>\n          {t('recordingsListen:subtitle')}\n        </Subtitle>\n        <PlayerContainer>\n          <PlayerContainerTop>\n            <PlayerTopMiddle>\n              <PlayerFileName>\n                {fileName}\n              </PlayerFileName>\n            </PlayerTopMiddle>\n            <PlayerCrossContainer\n              onClick={handleRemoveFile}\n            >\n              <PlayerCross\n                src={CrossSVG}\n              />\n            </PlayerCrossContainer>\n          </PlayerContainerTop>\n          <PlayerContainerBottom>\n            <PlayerBottomTop>\n              <PlayerBottomTrack\n                playing={playing}\n                progress={trackProgress}\n              />\n              <PlayerBottomThumb\n                playing={playing}\n                progress={trackProgress}\n              />\n            </PlayerBottomTop>\n            <PlayerBottomBottom>\n              <PlayerTimeIndicator>\n                {currentTime}\n              </PlayerTimeIndicator>\n              <PlayerTimeIndicator>\n                {remainingTime}\n              </PlayerTimeIndicator>\n            </PlayerBottomBottom>\n          </PlayerContainerBottom>\n        </PlayerContainer>\n        <PlayerPlayContainer\n          onClick={playing ? handlePause : handlePlay}\n        >\n          <PlayerPlayButton>\n            <PlayerPlay\n              src={playing ? PauseSVG : PlaySVG}\n            />\n          </PlayerPlayButton>\n        </PlayerPlayContainer>\n      </MainContainer>\n      <ImportantNote>\n        <Trans i18nKey=\"main:note\">\n          <strong>Please note:</strong> This form is for data collection only. It will not predict your COVID-19\n          status or diagnose any disease, disorder, or other health condition. Virufy is conducting research and\n          will use the information you provide for that research only. Virufy will not take place of a doctor and\n          would like to remind you it is your responsibility to seek medical advice from your doctor.\n        </Trans>\n      </ImportantNote>\n      {activeStep && (\n        <Portal>\n          <WizardButtons\n            invert\n            leftLabel={t('recordingsListen:next')}\n            leftHandler={handleNext}\n            rightLabel={t('recordingsListen:retake')}\n            rightHandler={handleRemoveFile}\n          />\n        </Portal>\n      )}\n    </>\n  );\n};\n\nexport default React.memo(ListenAudio);\n"]},"metadata":{},"sourceType":"module"}