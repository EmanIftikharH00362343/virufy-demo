{"ast":null,"code":"import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _defineProperty from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _regeneratorRuntime from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/amil/virufy-demo.github.io/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React from'react';import usePortal from'react-useportal';import{useTranslation}from'react-i18next';// Form\nimport{Controller,useForm}from'react-hook-form';import{yupResolver}from'@hookform/resolvers/yup';import*as Yup from'yup';// Components\nimport MicRecorder from'components/MicRecorder';import WizardButtons from'components/WizardButtons';// Images\nimport UploadSVG from\"assets/icons/upload.svg\";// Styles\nimport{MainContainer,UploadContainer,UploadImage,UploadText,MicContainer}from'./style';var audioMaxSizeInMb=5;var schema=Yup.object({recordingFile:Yup.mixed().required('ERROR.FILE_REQUIRED').test('fileSize','ERROR.FILE_SIZE',function(value){if(value){var file=value;var size=file.size;return size<=Math.pow(1024,3)*audioMaxSizeInMb;}return!!value;}).test('fileDuration','ERROR.FILE_DURATION',/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(value){var file,audio,duration;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!value){_context.next=10;break;}file=value;audio=new Audio(URL.createObjectURL(file));audio.load();_context.next=6;return new Promise(function(resolver){return audio.addEventListener('loadedmetadata',resolver);});case 6:_context.next=8;return new Promise(function(resolver){if(audio.duration!==Infinity){resolver(audio.duration);}audio.addEventListener('durationchange',function(){audio.remove();resolver(audio.duration);});audio.volume=0;audio.currentTime=24*60*60;// Unprobable time\naudio.play();});case 8:duration=_context.sent;return _context.abrupt(\"return\",duration>=2);case 10:return _context.abrupt(\"return\",!!value);case 11:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}())}).defined();var Record=function Record(_ref2){var onNext=_ref2.onNext,onManualUpload=_ref2.onManualUpload,defaultValues=_ref2.defaultValues,currentLogic=_ref2.currentLogic,action=_ref2.action;// Hooks\nvar _usePortal=usePortal({bindTo:document&&document.getElementById('wizard-buttons')}),Portal=_usePortal.Portal;var _useForm=useForm({mode:'onChange',defaultValues:defaultValues,resolver:yupResolver(schema)}),handleSubmit=_useForm.handleSubmit,control=_useForm.control,getValues=_useForm.getValues,formState=_useForm.formState;var _useTranslation=useTranslation(),t=_useTranslation.t;var isValid=formState.isValid;// Refs\nvar micKey=React.useRef(1);var onManualUploadWithFile=function onManualUploadWithFile(){action(_defineProperty({},currentLogic,{recordingFile:getValues('recordingFile')||null,uploadedFile:null}));onManualUpload===null||onManualUpload===void 0?void 0:onManualUpload();};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(MainContainer,{children:[/*#__PURE__*/_jsx(MicContainer,{children:/*#__PURE__*/_jsx(Controller,{control:control,name:\"recordingFile\",render:function render(_ref3){var onChange=_ref3.onChange;return/*#__PURE__*/_jsx(MicRecorder,{// On delete, easy re-mount a new mic recorder\nonNewRecord:onChange,recordingFile:defaultValues===null||defaultValues===void 0?void 0:defaultValues.recordingFile},micKey.current);}})}),/*#__PURE__*/_jsxs(Portal,{children:[/*#__PURE__*/_jsx(WizardButtons,{invert:true,leftLabel:t('recordingsRecord:next'),leftDisabled:!isValid,leftHandler:handleSubmit(onNext)}),/*#__PURE__*/_jsxs(UploadContainer,{onClick:onManualUploadWithFile,children:[/*#__PURE__*/_jsx(UploadImage,{src:UploadSVG}),/*#__PURE__*/_jsx(UploadText,{children:t('recordingsRecord:upload')})]})]})]})});};export default/*#__PURE__*/React.memo(Record);","map":{"version":3,"sources":["/home/amil/virufy-demo.github.io/src/containers/SubmitSteps/RecordingsSteps/Introduction/Record/Record.tsx"],"names":["React","usePortal","useTranslation","Controller","useForm","yupResolver","Yup","MicRecorder","WizardButtons","MainContainer","UploadContainer","UploadImage","UploadText","MicContainer","audioMaxSizeInMb","schema","object","recordingFile","mixed","required","test","value","file","size","audio","Audio","URL","createObjectURL","load","Promise","resolver","addEventListener","duration","Infinity","remove","volume","currentTime","play","defined","Record","onNext","onManualUpload","defaultValues","currentLogic","action","bindTo","document","getElementById","Portal","mode","handleSubmit","control","getValues","formState","t","isValid","micKey","useRef","onManualUploadWithFile","uploadedFile","onChange","current","UploadSVG","memo"],"mappings":"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","sourcesContent":["import React from 'react';\nimport usePortal from 'react-useportal';\nimport { useTranslation } from 'react-i18next';\n\n// Form\nimport { Controller, useForm } from 'react-hook-form';\nimport { yupResolver } from '@hookform/resolvers/yup';\nimport * as Yup from 'yup';\n\n// Components\nimport MicRecorder from 'components/MicRecorder';\nimport WizardButtons from 'components/WizardButtons';\n\n// Images\nimport UploadSVG from 'assets/icons/upload.svg';\n\n// Styles\nimport {\n  MainContainer,\n  UploadContainer,\n  UploadImage,\n  UploadText,\n  MicContainer,\n} from './style';\n\nconst audioMaxSizeInMb = 5;\n\nconst schema = Yup.object({\n  recordingFile: Yup.mixed()\n    .required('ERROR.FILE_REQUIRED')\n    .test('fileSize', 'ERROR.FILE_SIZE', (value?: any) => {\n      if (value) {\n        const file = value as File;\n        const { size } = file;\n        return (size <= 1024 ** 3 * audioMaxSizeInMb);\n      }\n      return !!value;\n    })\n    .test('fileDuration', 'ERROR.FILE_DURATION', async (value?: any) => {\n      if (value) {\n        const file = value as File;\n        const audio = new Audio(URL.createObjectURL(file));\n        audio.load();\n        await new Promise(resolver => audio.addEventListener('loadedmetadata', resolver));\n        const duration: number = await new Promise(resolver => {\n          if (audio.duration !== Infinity) {\n            resolver(audio.duration);\n          }\n          audio.addEventListener('durationchange', () => {\n            audio.remove();\n            resolver(audio.duration);\n          });\n          audio.volume = 0;\n          audio.currentTime = 24 * 60 * 60; // Unprobable time\n          audio.play();\n        });\n        return (duration >= 2);\n      }\n      return !!value;\n    }),\n}).defined();\n\nexport type RecordType = Yup.InferType<typeof schema>;\n\ninterface RecordProps {\n  onNext: (values: RecordType) => void,\n  onManualUpload: () => void,\n  defaultValues: RecordType,\n  currentLogic: string,\n  action:any,\n}\n\nconst Record = ({\n  onNext,\n  onManualUpload,\n  defaultValues,\n  currentLogic,\n  action,\n}: RecordProps) => {\n  // Hooks\n  const { Portal } = usePortal({\n    bindTo:\n      document && (document.getElementById('wizard-buttons') as HTMLDivElement),\n  });\n  const {\n    handleSubmit, control, getValues, formState,\n  } = useForm({\n    mode: 'onChange',\n    defaultValues,\n    resolver: yupResolver(schema),\n  });\n  const { t } = useTranslation();\n\n  const { isValid } = formState;\n\n  // Refs\n  const micKey = React.useRef<number>(1);\n\n  const onManualUploadWithFile = () => {\n    action({\n      [currentLogic]: {\n        recordingFile: getValues('recordingFile') || null,\n        uploadedFile: null,\n      },\n    });\n    onManualUpload?.();\n  };\n\n  return (\n    <>\n      <MainContainer>\n        <MicContainer>\n          <Controller\n            control={control}\n            name=\"recordingFile\"\n            render={({ onChange }) => (\n              <MicRecorder\n                key={micKey.current} // On delete, easy re-mount a new mic recorder\n                onNewRecord={onChange}\n                recordingFile={defaultValues?.recordingFile}\n              />\n            )}\n          />\n        </MicContainer>\n\n        <Portal>\n          <WizardButtons\n            invert\n            leftLabel={t('recordingsRecord:next')}\n            leftDisabled={!isValid}\n            leftHandler={handleSubmit(onNext)}\n          />\n          {/* Upload Container */}\n          <UploadContainer onClick={onManualUploadWithFile}>\n            <UploadImage src={UploadSVG} />\n            <UploadText>{t('recordingsRecord:upload')}</UploadText>\n          </UploadContainer>\n        </Portal>\n      </MainContainer>\n    </>\n  );\n};\n\nexport default React.memo(Record);\n"]},"metadata":{},"sourceType":"module"}