{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/amil/virufy-demo.github.io/src/containers/SubmitSteps/RecordingsSteps/ListenAudio/ListenAudio.tsx\",\n    _s = $RefreshSig$();\n\n/* eslint-disable jsx-a11y/media-has-caption */\n\n/* eslint-disable jsx-a11y/click-events-have-key-events */\n\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React, { useEffect } from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport usePortal from 'react-useportal';\nimport { useTranslation, Trans } from 'react-i18next'; // Form\n\nimport { useStateMachine } from 'little-state-machine'; // Header Control\n\nimport useHeaderContext from 'hooks/useHeaderContext'; // Components\n\nimport WizardButtons from 'components/WizardButtons'; // Utils\n\nimport { updateAction } from 'utils/wizard';\nimport { scrollToTop } from 'helper/scrollHelper';\nimport { getDuration } from 'helper/getDuration'; // Images\n\nimport PlaySVG from \"assets/icons/play.svg\";\nimport PauseSVG from \"assets/icons/pause.svg\";\nimport CrossSVG from \"assets/icons/cross.svg\"; // Styles\n\nimport fileHelper from 'helper/fileHelper';\nimport { MainContainer, Subtitle, PlayerContainer, PlayerContainerTop, PlayerContainerBottom, PlayerPlay, PlayerCross, PlayerFileName, PlayerTopMiddle, PlayerPlayContainer, PlayerPlayButton, PlayerCrossContainer, PlayerBottomTop, PlayerBottomTrack, PlayerBottomThumb, PlayerBottomBottom, PlayerTimeIndicator, ImportantNote } from './style';\n\nconst ListenAudio = ({\n  storeKey,\n  previousStep,\n  nextStep,\n  metadata\n}) => {\n  _s();\n\n  var _state$storeKey;\n\n  // Hooks\n  const {\n    Portal\n  } = usePortal({\n    bindTo: document && document.getElementById('wizard-buttons')\n  });\n  const {\n    setDoGoBack,\n    setSubtitle\n  } = useHeaderContext();\n  const history = useHistory();\n  const location = useLocation();\n  const {\n    state,\n    actions\n  } = useStateMachine({\n    updateAction: updateAction(storeKey)\n  });\n  const {\n    t\n  } = useTranslation();\n  const myState = state === null || state === void 0 ? void 0 : (_state$storeKey = state[storeKey]) === null || _state$storeKey === void 0 ? void 0 : _state$storeKey[metadata === null || metadata === void 0 ? void 0 : metadata.currentLogic];\n  const file = myState ? myState.recordingFile || myState.uploadedFile : null; // Refs\n\n  const refAudio = React.useRef(null);\n  const refTimer = React.useRef();\n  const refProgress = React.useRef(0); // States\n\n  const [activeStep, setActiveStep] = React.useState(true);\n  const [playing, setPlaying] = React.useState(false);\n  const [duration, setDuration] = React.useState(0);\n  const [progressSeconds, setProgressSeconds] = React.useState(0); // Effects\n\n  React.useEffect(() => {\n    const stepTimer = ms => {\n      setProgressSeconds(ms / 1000);\n      refProgress.current = ms;\n      refTimer.current = setTimeout(() => {\n        stepTimer(ms + 200);\n      }, 200);\n    };\n\n    const fnPlaying = () => {\n      stepTimer(refProgress.current);\n      setTimeout(() => {\n        setPlaying(true);\n      }, 0);\n    };\n\n    const fnPause = e => {\n      if (e.target.currentTime >= e.target.duration) {\n        setProgressSeconds(0);\n        refProgress.current = 0;\n      }\n\n      setPlaying(false);\n      clearTimeout(refTimer.current);\n    };\n\n    const fnLoad = async e => {\n      const recordDuration = await getDuration(e.target);\n      setDuration(recordDuration);\n    };\n\n    if (refAudio.current) {\n      refAudio.current.addEventListener('playing', fnPlaying);\n      refAudio.current.addEventListener('pause', fnPause);\n      refAudio.current.addEventListener('loadedmetadata', fnLoad);\n    }\n\n    return () => {\n      if (refAudio.current) {\n        refAudio.current.removeEventListener('playing', fnPlaying); // eslint-disable-next-line react-hooks/exhaustive-deps\n\n        refAudio.current.removeEventListener('pause', fnPause); // eslint-disable-next-line react-hooks/exhaustive-deps\n\n        refAudio.current.removeEventListener('loadedmetadata', fnLoad);\n      }\n    };\n  }, []); // Memos\n\n  const {\n    fileUrl,\n    fileName\n  } = React.useMemo(() => {\n    const out = {\n      fileUrl: '',\n      fileName: '',\n      fileSize: ''\n    };\n\n    if (file && file.size !== undefined) {\n      try {\n        const url = URL.createObjectURL(file);\n        out.fileUrl = url;\n        out.fileName = file.name;\n        out.fileSize = fileHelper.sizeAsHuman(file.size, true);\n      } catch (e) {\n        console.log('Error', e);\n      }\n    }\n\n    return out;\n  }, [file]); // Handlers\n\n  const handleNext = React.useCallback(() => {\n    if (nextStep) {\n      // action(values);\n      setActiveStep(false);\n      history.push(nextStep);\n    }\n  }, [history, nextStep]);\n  const handleDoBack = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n\n    setActiveStep(false);\n\n    if (location.state && location.state.from) {\n      const newRoute = '/submit-steps/step-record/cough';\n      history.push(newRoute);\n    } else if (previousStep) {\n      history.push(previousStep);\n    } else {\n      history.goBack();\n    }\n  }, [location.state, previousStep, history, playing]);\n  const handleRemoveFile = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n\n    if (state === null || state === void 0 ? void 0 : state[storeKey][metadata === null || metadata === void 0 ? void 0 : metadata.currentLogic]) {\n      actions.updateAction({\n        [metadata === null || metadata === void 0 ? void 0 : metadata.currentLogic]: {\n          recordingFile: null,\n          uploadFile: null\n        }\n      });\n      handleDoBack();\n    }\n  }, [playing, state, storeKey, metadata, actions, handleDoBack]);\n  const handlePlay = React.useCallback(() => {\n    if (!playing) {\n      setProgressSeconds(0);\n\n      if (refAudio.current) {\n        refAudio.current.play();\n      }\n    }\n  }, [playing]);\n  const handlePause = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n  }, [playing]); // Effects\n\n  useEffect(() => {\n    scrollToTop();\n    setSubtitle(t('recordingsListen:title'));\n    setDoGoBack(() => handleDoBack);\n  }, [handleDoBack, setDoGoBack, setSubtitle, t]); // Memos\n\n  const {\n    currentTime,\n    remainingTime,\n    trackProgress\n  } = React.useMemo(() => {\n    const out = {\n      currentTime: '0:00',\n      remainingTime: '0:00',\n      trackProgress: 0\n    };\n\n    if (duration) {\n      const minutes = Math.floor(Math.floor(progressSeconds) / 60);\n      const seconds = Math.floor(progressSeconds) - minutes * 60;\n      out.currentTime = `${minutes}:${seconds < 10 ? `0${seconds}` : seconds}`;\n      const timeRemaining = duration > progressSeconds ? Math.ceil(duration - progressSeconds) : 0;\n      const minutesRemaining = Math.floor(timeRemaining / 60);\n      const secondsRemaining = timeRemaining - minutesRemaining * 60;\n      out.remainingTime = `-${minutesRemaining}:${secondsRemaining < 10 ? `0${secondsRemaining}` : secondsRemaining}`;\n      out.trackProgress = Math.ceil(progressSeconds / duration * 100);\n    }\n\n    return out;\n  }, [duration, progressSeconds]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [fileUrl && /*#__PURE__*/_jsxDEV(\"audio\", {\n      ref: refAudio,\n      children: /*#__PURE__*/_jsxDEV(\"source\", {\n        src: fileUrl\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 260,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 11\n    }, this), /*#__PURE__*/_jsxDEV(MainContainer, {\n      children: [/*#__PURE__*/_jsxDEV(Subtitle, {\n        children: t('recordingsListen:subtitle')\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(PlayerContainer, {\n        children: [/*#__PURE__*/_jsxDEV(PlayerContainerTop, {\n          children: [/*#__PURE__*/_jsxDEV(PlayerTopMiddle, {\n            children: /*#__PURE__*/_jsxDEV(PlayerFileName, {\n              children: fileName\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 273,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(PlayerCrossContainer, {\n            onClick: handleRemoveFile,\n            children: /*#__PURE__*/_jsxDEV(PlayerCross, {\n              src: CrossSVG\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 280,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(PlayerContainerBottom, {\n          children: [/*#__PURE__*/_jsxDEV(PlayerBottomTop, {\n            children: [/*#__PURE__*/_jsxDEV(PlayerBottomTrack, {\n              playing: playing,\n              progress: trackProgress\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 287,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(PlayerBottomThumb, {\n              playing: playing,\n              progress: trackProgress\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 291,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(PlayerBottomBottom, {\n            children: [/*#__PURE__*/_jsxDEV(PlayerTimeIndicator, {\n              children: currentTime\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 297,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(PlayerTimeIndicator, {\n              children: remainingTime\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 300,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 296,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 270,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(PlayerPlayContainer, {\n        onClick: playing ? handlePause : handlePlay,\n        children: /*#__PURE__*/_jsxDEV(PlayerPlayButton, {\n          children: /*#__PURE__*/_jsxDEV(PlayerPlay, {\n            src: playing ? PauseSVG : PlaySVG\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 310,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 309,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ImportantNote, {\n      children: /*#__PURE__*/_jsxDEV(Trans, {\n        i18nKey: \"main:note\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Please note:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 318,\n          columnNumber: 11\n        }, this), \" This form is for data collection only. It will not predict your COVID-19 status or diagnose any disease, disorder, or other health condition. Virufy is conducting research and will use the information you provide for that research only. Virufy will not take place of a doctor and would like to remind you it is your responsibility to seek medical advice from your doctor.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 7\n    }, this), activeStep && /*#__PURE__*/_jsxDEV(Portal, {\n      children: /*#__PURE__*/_jsxDEV(WizardButtons, {\n        invert: true,\n        leftLabel: t('recordingsListen:next'),\n        leftHandler: handleNext,\n        rightLabel: t('recordingsListen:retake'),\n        rightHandler: handleRemoveFile\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 325,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n\n_s(ListenAudio, \"/EhgvF4IuxuayrWPvY8/UyBNxYc=\", false, function () {\n  return [usePortal, useHeaderContext, useHistory, useLocation, useStateMachine, useTranslation];\n});\n\n_c = ListenAudio;\nexport default _c2 = /*#__PURE__*/React.memo(ListenAudio);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ListenAudio\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/home/amil/virufy-demo.github.io/src/containers/SubmitSteps/RecordingsSteps/ListenAudio/ListenAudio.tsx"],"names":["React","useEffect","useHistory","useLocation","usePortal","useTranslation","Trans","useStateMachine","useHeaderContext","WizardButtons","updateAction","scrollToTop","getDuration","fileHelper","MainContainer","Subtitle","PlayerContainer","PlayerContainerTop","PlayerContainerBottom","PlayerPlay","PlayerCross","PlayerFileName","PlayerTopMiddle","PlayerPlayContainer","PlayerPlayButton","PlayerCrossContainer","PlayerBottomTop","PlayerBottomTrack","PlayerBottomThumb","PlayerBottomBottom","PlayerTimeIndicator","ImportantNote","ListenAudio","storeKey","previousStep","nextStep","metadata","Portal","bindTo","document","getElementById","setDoGoBack","setSubtitle","history","location","state","actions","t","myState","currentLogic","file","recordingFile","uploadedFile","refAudio","useRef","refTimer","refProgress","activeStep","setActiveStep","useState","playing","setPlaying","duration","setDuration","progressSeconds","setProgressSeconds","stepTimer","ms","current","setTimeout","fnPlaying","fnPause","e","target","currentTime","clearTimeout","fnLoad","recordDuration","addEventListener","removeEventListener","fileUrl","fileName","useMemo","out","fileSize","size","undefined","url","URL","createObjectURL","name","sizeAsHuman","console","log","handleNext","useCallback","push","handleDoBack","pause","from","newRoute","goBack","handleRemoveFile","uploadFile","handlePlay","play","handlePause","remainingTime","trackProgress","minutes","Math","floor","seconds","timeRemaining","ceil","minutesRemaining","secondsRemaining","CrossSVG","PauseSVG","PlaySVG","memo"],"mappings":"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","sourcesContent":["/* eslint-disable jsx-a11y/media-has-caption */\n/* eslint-disable jsx-a11y/click-events-have-key-events */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React, { useEffect } from 'react';\nimport { useHistory, useLocation } from 'react-router-dom';\nimport usePortal from 'react-useportal';\nimport { useTranslation, Trans } from 'react-i18next';\n\n// Form\nimport { useStateMachine } from 'little-state-machine';\n\n// Header Control\nimport useHeaderContext from 'hooks/useHeaderContext';\n\n// Components\nimport WizardButtons from 'components/WizardButtons';\n\n// Utils\nimport { updateAction } from 'utils/wizard';\nimport { scrollToTop } from 'helper/scrollHelper';\nimport { getDuration } from 'helper/getDuration';\n\n// Images\nimport PlaySVG from 'assets/icons/play.svg';\nimport PauseSVG from 'assets/icons/pause.svg';\nimport CrossSVG from 'assets/icons/cross.svg';\n\n// Styles\nimport fileHelper from 'helper/fileHelper';\nimport {\n  MainContainer,\n  Subtitle,\n  PlayerContainer,\n  PlayerContainerTop,\n  PlayerContainerBottom,\n  PlayerPlay,\n  PlayerCross,\n  PlayerFileName,\n  PlayerTopMiddle,\n  PlayerPlayContainer,\n  PlayerPlayButton,\n  PlayerCrossContainer,\n  PlayerBottomTop,\n  PlayerBottomTrack,\n  PlayerBottomThumb,\n  PlayerBottomBottom,\n  PlayerTimeIndicator,\n  ImportantNote,\n} from './style';\n\nconst ListenAudio = ({\n  storeKey,\n  previousStep,\n  nextStep,\n  metadata,\n}: Wizard.StepProps) => {\n  // Hooks\n  const { Portal } = usePortal({\n    bindTo: document && document.getElementById('wizard-buttons') as HTMLDivElement,\n  });\n  const { setDoGoBack, setSubtitle } = useHeaderContext();\n  const history = useHistory();\n  const location = useLocation<{ from: string }>();\n  const { state, actions } = useStateMachine({ updateAction: updateAction(storeKey) });\n  const { t } = useTranslation();\n\n  const myState = state?.[storeKey]?.[metadata?.currentLogic];\n  const file: File | null = myState ? myState.recordingFile || myState.uploadedFile : null;\n\n  // Refs\n  const refAudio = React.useRef<HTMLMediaElement>(null);\n  const refTimer = React.useRef<any>();\n  const refProgress = React.useRef<number>(0);\n\n  // States\n  const [activeStep, setActiveStep] = React.useState(true);\n  const [playing, setPlaying] = React.useState(false);\n  const [duration, setDuration] = React.useState<number>(0);\n  const [progressSeconds, setProgressSeconds] = React.useState<number>(0);\n\n  // Effects\n  React.useEffect(() => {\n    const stepTimer = (ms: number) => {\n      setProgressSeconds(ms / 1000);\n      refProgress.current = ms;\n      refTimer.current = setTimeout(() => {\n        stepTimer(ms + 200);\n      }, 200);\n    };\n\n    const fnPlaying = () => {\n      stepTimer(refProgress.current);\n      setTimeout(() => {\n        setPlaying(true);\n      }, 0);\n    };\n\n    const fnPause = (e: any) => {\n      if (e.target.currentTime >= e.target.duration) {\n        setProgressSeconds(0);\n        refProgress.current = 0;\n      }\n      setPlaying(false);\n      clearTimeout(refTimer.current);\n    };\n\n    const fnLoad = async (e: any) => {\n      const recordDuration = await getDuration(e.target);\n      setDuration(recordDuration);\n    };\n\n    if (refAudio.current) {\n      refAudio.current.addEventListener('playing', fnPlaying);\n      refAudio.current.addEventListener('pause', fnPause);\n      refAudio.current.addEventListener('loadedmetadata', fnLoad);\n    }\n\n    return () => {\n      if (refAudio.current) {\n        refAudio.current.removeEventListener('playing', fnPlaying);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        refAudio.current.removeEventListener('pause', fnPause);\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n        refAudio.current.removeEventListener('loadedmetadata', fnLoad);\n      }\n    };\n  }, []);\n\n  // Memos\n  const {\n    fileUrl,\n    fileName,\n  } = React.useMemo(() => {\n    const out = {\n      fileUrl: '',\n      fileName: '',\n      fileSize: '',\n    };\n    if (file && file.size !== undefined) {\n      try {\n        const url = URL.createObjectURL(file);\n        out.fileUrl = url;\n        out.fileName = file.name;\n        out.fileSize = fileHelper.sizeAsHuman(file.size, true);\n      } catch (e) {\n        console.log('Error', e);\n      }\n    }\n    return out;\n  }, [file]);\n\n  // Handlers\n  const handleNext = React.useCallback(() => {\n    if (nextStep) {\n      // action(values);\n      setActiveStep(false);\n      history.push(nextStep);\n    }\n  }, [history, nextStep]);\n\n  const handleDoBack = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n    setActiveStep(false);\n    if (location.state && location.state.from) {\n      const newRoute = '/submit-steps/step-record/cough';\n      history.push(newRoute);\n    } else if (previousStep) {\n      history.push(previousStep);\n    } else {\n      history.goBack();\n    }\n  }, [location.state, previousStep, history, playing]);\n\n  const handleRemoveFile = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n\n    if (state?.[storeKey][metadata?.currentLogic]) {\n      actions.updateAction({\n        [metadata?.currentLogic]: {\n          recordingFile: null,\n          uploadFile: null,\n        },\n      });\n      handleDoBack();\n    }\n  }, [\n    playing,\n    state,\n    storeKey,\n    metadata,\n    actions,\n    handleDoBack,\n  ]);\n\n  const handlePlay = React.useCallback(() => {\n    if (!playing) {\n      setProgressSeconds(0);\n      if (refAudio.current) {\n        refAudio.current.play();\n      }\n    }\n  }, [playing]);\n\n  const handlePause = React.useCallback(() => {\n    if (playing) {\n      if (refAudio.current) {\n        refAudio.current.pause();\n      }\n    }\n  }, [playing]);\n\n  // Effects\n  useEffect(() => {\n    scrollToTop();\n    setSubtitle(t('recordingsListen:title'));\n    setDoGoBack(() => handleDoBack);\n  }, [handleDoBack, setDoGoBack, setSubtitle, t]);\n\n  // Memos\n  const {\n    currentTime,\n    remainingTime,\n    trackProgress,\n  } = React.useMemo(() => {\n    const out = {\n      currentTime: '0:00',\n      remainingTime: '0:00',\n      trackProgress: 0,\n    };\n    if (duration) {\n      const minutes = Math.floor(Math.floor(progressSeconds) / 60);\n      const seconds = Math.floor(progressSeconds) - (minutes * 60);\n      out.currentTime = `${minutes}:${seconds < 10 ? `0${seconds}` : seconds}`;\n\n      const timeRemaining = duration > progressSeconds ? Math.ceil(duration - progressSeconds) : 0;\n      const minutesRemaining = Math.floor(timeRemaining / 60);\n      const secondsRemaining = timeRemaining - (minutesRemaining * 60);\n      out.remainingTime = `-${minutesRemaining}:${secondsRemaining < 10 ? `0${secondsRemaining}` : secondsRemaining}`;\n\n      out.trackProgress = Math.ceil((progressSeconds / duration) * 100);\n    }\n    return out;\n  }, [duration, progressSeconds]);\n\n  return (\n    <>\n      {\n        fileUrl && (\n          <audio\n            ref={refAudio}\n          >\n            <source\n              src={fileUrl}\n            />\n          </audio>\n        )\n      }\n      <MainContainer>\n        <Subtitle>\n          {t('recordingsListen:subtitle')}\n        </Subtitle>\n        <PlayerContainer>\n          <PlayerContainerTop>\n            <PlayerTopMiddle>\n              <PlayerFileName>\n                {fileName}\n              </PlayerFileName>\n            </PlayerTopMiddle>\n            <PlayerCrossContainer\n              onClick={handleRemoveFile}\n            >\n              <PlayerCross\n                src={CrossSVG}\n              />\n            </PlayerCrossContainer>\n          </PlayerContainerTop>\n          <PlayerContainerBottom>\n            <PlayerBottomTop>\n              <PlayerBottomTrack\n                playing={playing}\n                progress={trackProgress}\n              />\n              <PlayerBottomThumb\n                playing={playing}\n                progress={trackProgress}\n              />\n            </PlayerBottomTop>\n            <PlayerBottomBottom>\n              <PlayerTimeIndicator>\n                {currentTime}\n              </PlayerTimeIndicator>\n              <PlayerTimeIndicator>\n                {remainingTime}\n              </PlayerTimeIndicator>\n            </PlayerBottomBottom>\n          </PlayerContainerBottom>\n        </PlayerContainer>\n        <PlayerPlayContainer\n          onClick={playing ? handlePause : handlePlay}\n        >\n          <PlayerPlayButton>\n            <PlayerPlay\n              src={playing ? PauseSVG : PlaySVG}\n            />\n          </PlayerPlayButton>\n        </PlayerPlayContainer>\n      </MainContainer>\n      <ImportantNote>\n        <Trans i18nKey=\"main:note\">\n          <strong>Please note:</strong> This form is for data collection only. It will not predict your COVID-19\n          status or diagnose any disease, disorder, or other health condition. Virufy is conducting research and\n          will use the information you provide for that research only. Virufy will not take place of a doctor and\n          would like to remind you it is your responsibility to seek medical advice from your doctor.\n        </Trans>\n      </ImportantNote>\n      {activeStep && (\n        <Portal>\n          <WizardButtons\n            invert\n            leftLabel={t('recordingsListen:next')}\n            leftHandler={handleNext}\n            rightLabel={t('recordingsListen:retake')}\n            rightHandler={handleRemoveFile}\n          />\n        </Portal>\n      )}\n    </>\n  );\n};\n\nexport default React.memo(ListenAudio);\n"]},"metadata":{},"sourceType":"module"}