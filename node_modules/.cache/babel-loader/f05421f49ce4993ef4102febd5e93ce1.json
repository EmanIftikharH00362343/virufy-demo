{"ast":null,"code":"/* eslint-disable func-names */export default function(){var _this=this;// Parts copied from https://github.com/chris-rudmin/Recorderjs\nvar BYTES_PER_SAMPLE=2;var CHANNELS=1;// 1=mono , 2=Stereo\nvar recorded=[];function encode(buffer){var length=buffer.length;var data=new Uint8Array(length*BYTES_PER_SAMPLE*CHANNELS);for(var i=0;i<length;i+=1){var index=i*BYTES_PER_SAMPLE*CHANNELS;var sample=buffer[i];if(sample>1){sample=1;}else if(sample<-1){sample=-1;}sample*=32768;data[index]=sample;// eslint-disable-next-line no-bitwise\ndata[index+1]=sample>>8;}recorded.push(data);}function dump(sampleRate){var bufferLength=recorded.length?recorded[0].length:0;var length=recorded.length*bufferLength;var wav=new Uint8Array(44+length);var view=new DataView(wav.buffer);// RIFF identifier 'RIFF'\nview.setUint32(0,1380533830,false);// file length minus RIFF identifier length and file description length\nview.setUint32(4,36+length,true);// RIFF type 'WAVE'\nview.setUint32(8,1463899717,false);// format chunk identifier 'fmt '\nview.setUint32(12,1718449184,false);// format chunk length\nview.setUint32(16,16,true);// sample format (raw)\nview.setUint16(20,1,true);// channel count\nview.setUint16(22,CHANNELS,true);// sample rate\nview.setUint32(24,sampleRate,true);// 44100 Khz\n// byte rate (channels * sample rate * block align)\nview.setUint32(28,CHANNELS*sampleRate*BYTES_PER_SAMPLE,true);// kbps = 1411\n// block align (channel count * bytes per sample)\nview.setUint16(32,CHANNELS*BYTES_PER_SAMPLE,true);// bits per sample\nview.setUint16(34,8*BYTES_PER_SAMPLE,true);// 16\n// data chunk identifier 'data'\nview.setUint32(36,1684108385,false);// data chunk length\nview.setUint32(40,length,true);for(var i=0;i<recorded.length;i+=1){wav.set(recorded[i],i*bufferLength+44);}recorded=[];var msg=[wav.buffer];postMessage(msg,[msg[0]]);}this.onmessage=function(e){if(e.data[0]==='encode'){encode(e.data[1]);}else if(e.data[0]==='dump'){dump(e.data[1]);}else if(e.data[0]==='close'){_this.close();}};}","map":null,"metadata":{},"sourceType":"module"}